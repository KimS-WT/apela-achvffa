@page "{id:int}"
@model ChoctawGivingCircle.Pages.Requests.DetailsModel
@{
    ViewData["Title"] = Model.Item?.Title ?? "Request Details";
}

<div class="container py-4">
    @if (Model.Item is null)
    {
        <div class="alert alert-danger">Request could not be found.</div>
    }
    else
    {
        <a class="btn btn-link px-0 mb-3" asp-page="/Requests/Index">← Back to Requests</a>

        <div class="card shadow-sm">
            <div class="card-body">
                <h1 class="h3">@Model.Item.Title</h1>
                <p class="text-muted mb-3">@Model.Item.Description</p>

                <dl class="row mb-0">
                    <dt class="col-sm-3">Category</dt>
                    <dd class="col-sm-9">@Model.Item.Category</dd>

                    <dt class="col-sm-3">Priority</dt>
                    <dd class="col-sm-9">@Model.Item.Priority</dd>

                    <dt class="col-sm-3">Estimated Cost</dt>
                    <dd class="col-sm-9">@Model.Item.EstimatedCost.ToString("C")</dd>

                    <dt class="col-sm-3">Status</dt>
                    <dd class="col-sm-9">@Model.Item.Status</dd>

                    <dt class="col-sm-3">Needed By</dt>
                    <dd class="col-sm-9">
                        @(Model.Item.NeededByDate?.ToString("D") ?? "Flexible")
                    </dd>
                </dl>
                <div class="mt-4">
                    <h5>Funding Progress</h5>
                    <div class="progress mb-2" style="height:24px;">
                        <div class="progress-bar" role="progressbar" style="width:@Model.ProgressPercent%" aria-valuenow="@Model.ProgressPercent" aria-valuemin="0" aria-valuemax="100">
                            @Model.ProgressPercent% (@Model.FundedAmount.ToString("C"))
                        </div>
                    </div>
                    <a class="btn btn-choctaw me-2" asp-page="/Contributions/Create" asp-route-requestId="@Model.Item.Id">Quick Donate</a>
                    <a class="btn btn-outline-secondary" asp-page="/Contributions/Create">Donate to General Fund</a>
                </div>

                <div class="mt-4">
                    <h5>Contributions</h5>
                    @if (Model.Contributions == null || !Model.Contributions.Any())
                    {
                        <div class="text-muted">No contributions yet — be the first to help.</div>
                    }
                    else
                    {
                        <ul class="list-group">
                            @foreach (var c in Model.Contributions)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                    <div>
                                        <div class="fw-bold">@c.ContributionType - @c.Amount.ToString("C")</div>
                                        <div class="text-muted small">@c.Notes</div>
                                        <div class="text-muted small">@c.CreatedAt.ToLocalTime().ToString("g")</div>
                                    </div>
                                    <div class="text-end">
                                        <div class="small">@((c.DonorUser?.DisplayName) ?? "Anonymous")</div>
                                    </div>
                                </li>
                            }
                        </ul>
                    }
                </div>
            </div>
        </div>
    }
</div>
